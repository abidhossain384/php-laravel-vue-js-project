<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Module 12 - Date Limited Quiz App</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #f4f4f4;
            margin: 0;
            padding: 20px;
        }

        .container {
            max-width: 700px;
            margin: auto;
            background: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }

        h1,
        h2 {
            text-align: center;
        }

        .hidden {
            display: none;
        }

        button {
            background: #007BFF;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 10px;
            width: 100%;
        }

        button:hover {
            background: #0056b3;
        }

        .question {
            margin: 15px 0;
        }

        .timer {
            text-align: right;
            font-weight: bold;
            color: red;
            margin-bottom: 10px;
        }

        .result {
            text-align: center;
            font-size: 20px;
            font-weight: bold;
        }

        input[type="text"],
        input[type="email"] {
            width: 100%;
            padding: 8px;
            margin: 8px 0;
            border: 1px solid #ccc;
            border-radius: 4px;
        }

        label {
            display: block;
            margin: 5px 0;
        }

        /* Responsive */
        @media (max-width: 600px) {
            .container {
                padding: 15px;
            }

            button {
                font-size: 14px;
            }
        }
    </style>
</head>

<body>
    <!-- Login Page -->
    <div class="container" id="loginPage">
        <h1>Login</h1>
        <form id="loginForm">
            <label>Name:
                <input type="text" id="username" required>
            </label>
            <label>Email:
                <input type="email" id="email" required>
            </label>
            <button type="submit">Login</button>
        </form>
    </div>

    <!-- Quiz Page -->
    <div class="container hidden" id="quizPage">
        <h2>Quiz App</h2>
        <div class="timer" id="timer">Time left: 20:00</div>
        <form id="quizForm"></form>
        <button id="submitBtn">Submit Quiz</button>
    </div>

    <!-- Result Page -->
    <div class="container hidden" id="resultPage">
        <h2>Quiz Result</h2>
        <div class="result" id="result"></div>
        <p id="attemptInfo"></p>
        <button id="tryAgainBtn">Try Again</button>
        <button id="logoutBtn">Logout</button>
    </div>

    <script>
        // ==============================
        // Quiz Data & Settings
        // ==============================
        const quizQuestions = [
            { q: "What is 2+2?", options: ["3", "4", "5", "6"], answer: "4" },
            { q: "Which keyword declare variable in JS?", options: ["var", "int", "string", "def"], answer: "var" },
            { q: "JSON stands for?", options: ["Java Source Object Notation", "JavaScript Object Notation", "JavaScript Order Number", "None"], answer: "JavaScript Object Notation" },
            { q: "Which method adds item to end of array?", options: ["push()", "pop()", "shift()", "unshift()"], answer: "push()" },
            { q: "Which object gives browser info?", options: ["window", "navigator", "document", "location"], answer: "navigator" },
            { q: "Which method converts string to uppercase?", options: ["toLowerCase()", "toUpperCase()", "charAt()", "slice()"], answer: "toUpperCase()" },
            { q: "Which method gives current date?", options: ["Date.now()", "new Date()", "Math.random()", "Number()"], answer: "new Date()" },
            { q: "Which operator checks both value & type?", options: ["==", "=", "===", "!=="], answer: "===" },
            { q: "DOM stands for?", options: ["Document Object Model", "Data Object Method", "Desktop Object Manager", "None"], answer: "Document Object Model" },
            { q: "Which event fires when button clicked?", options: ["onload", "onchange", "onclick", "onsubmit"], answer: "onclick" },
        ];

        const quizDuration = 20 * 60;
        const startDate = new Date("2025-09-20");
        const endDate = new Date("2025-10-10");
        const maxAttempts = 10;

        let timerInterval, timeLeft = quizDuration;

        window.onload = function() {
            const user = JSON.parse(localStorage.getItem("quizUser"));
            const attempts = parseInt(localStorage.getItem("quizAttempts"));
            const result = localStorage.getItem("quizResult");

            if(user && attempts >= maxAttempts) {
                showResultPage("You Have Already Ten Attempts");
            }
            else if(user && result) {
                showResultPage(result);
            }
        }

        // debugger;

        // Login Handle
        // document.getElementById("loginForm").addEventListener("submit", function(e) {
        //     e.preventDefault();
        //     const username = document.getElementById("username").value;
        //     const email = document.getElementById("email").value;
        //     // alert(username + email);
        //     localStorage.setItem("quizUser", JSON.stringify({username, email}));
        //     startQuiz();
        // });

        // Login Handle
        document.getElementById("loginForm").addEventListener("submit", function(e) {
            e.preventDefault();
            const username = document.getElementById("username").value;
            const email = document.getElementById("email").value;

            // Date Validation
            let today = new Date();
            if (today < startDate || today > endDate) {
                alert("The quiz is not available at this time.");
                return;
            }

            // Attempt Validation
            let attempts = parseInt(localStorage.getItem("quizAttempts") || 0);
            if (attempts >= maxAttempts) {
                alert("You have already attempted the quiz 10 times. You cannot login again.");
                return;
            }

            // Save user and start quiz
            localStorage.setItem("quizUser", JSON.stringify({ username, email }));
            startQuiz();
        });

        function startQuiz() {
            // alert("Quiz Started");
            document.getElementById("loginPage").classList.add("hidden");
            document.getElementById("quizPage").classList.remove("hidden");

            loadQuiz();
            startTimer();
        }

        // Load Quiz
        function loadQuiz() {
            const form = document.getElementById("quizForm");
            form.innerHTML = "";
            quizQuestions.forEach((item, index)=>{
                const div = document.createElement("div");
                div.classList.add("question");
                div.innerHTML = `<p>${index+1}. ${item.q}</p>`;

                item.options.forEach(opt=>{
                    const label = document.createElement("label");
                    label.innerHTML = `<input type="radio" name="q${index}" value="${opt}"> ${opt}`;
                    div.appendChild(label);
                });
                form.appendChild(div);
            })
        }

        // Submit Quiz
        document.getElementById("submitBtn").addEventListener("click", submitQuiz);

        function submitQuiz() {
            clearInterval(timerInterval);
            const form = document.getElementById("quizForm");
            let score = 0;

            quizQuestions.forEach((item, index) => {
                const ans = form[`q${index}`]?.value;
                if (ans === item.answer) score++;
            });

            // Date Validation
            let toDay = new Date();
            if (toDay < startDate || toDay > endDate) {
                score = Math.floor(score / 2); // integer score
            }

            // Save Attempts
            let attempts = parseInt(localStorage.getItem("quizAttempts") || 0) + 1;
            localStorage.setItem("quizAttempts", attempts);

            // Save Results (array of all attempts)
            let results = JSON.parse(localStorage.getItem("quizResults") || "[]");
            results.push({
                attempt: attempts,
                score: `${score}/${quizQuestions.length}`,
                date: new Date().toLocaleString()
            });
            localStorage.setItem("quizResults", JSON.stringify(results));

            showResultPage(`${score}/${quizQuestions.length}`);
        }

        // Show Result Page
        function showResultPage(result) {
            document.getElementById("loginPage").classList.add("hidden");
            document.getElementById("quizPage").classList.add("hidden");
            document.getElementById("resultPage").classList.remove("hidden");

            const attempts = localStorage.getItem("quizAttempts") || 0;
            document.getElementById("attemptInfo").textContent = `Attempts: ${attempts}/${maxAttempts}`;
            document.getElementById("result").textContent = `Latest Score: ${result}`;

            // Hide Try Again if max attempts reached
            if (attempts >= maxAttempts) {
                document.getElementById("tryAgainBtn").style.display = "none";
            }

            // Show history of all attempts
            let results = JSON.parse(localStorage.getItem("quizResults") || "[]");
            if (results.length > 0) {
                let historyHtml = "<h3>Previous Attempts</h3><ul>";
                results.forEach(r => {
                    historyHtml += `<li>Attempt ${r.attempt}: ${r.score} (on ${r.date})</li>`;
                });
                historyHtml += "</ul>";
                document.getElementById("attemptInfo").innerHTML += historyHtml;
            }
        }

        // Try Again
        document.getElementById("tryAgainBtn").addEventListener("click", () => {
            document.getElementById("resultPage").classList.add("hidden");
            document.getElementById("quizPage").classList.remove("hidden");
            loadQuiz();
            startTimer();
        });

        // Logout

        document.getElementById("logoutBtn").addEventListener("click", ()=>{
            localStorage.clear();
            location.reload();
        })

        // ==============================
        // Timer
        // ==============================
        function startTimer() {
            const timerEl = document.getElementById("timer");
            timeLeft = quizDuration;
            timerInterval = setInterval(() => {
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    submitQuiz();
                } else {
                    let min = Math.floor(timeLeft / 60);
                    let sec = timeLeft % 60;
                    timerEl.textContent = `Time left: ${min}:${sec < 10 ? "0" + sec : sec}`;
                    timeLeft--;
                }
            }, 1000);
        }


    </script>
</body>

</html>